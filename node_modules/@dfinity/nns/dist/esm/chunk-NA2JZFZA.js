import{a as W,b as Q}from"./chunk-JKX2HJUB.js";import{b as M}from"./chunk-H6Y4RZE2.js";import{b as U}from"./chunk-WMBK2I6I.js";import{a as f}from"./chunk-IL4SIX75.js";import{c as H}from"./chunk-XMMTS4WT.js";import{b as E}from"./chunk-Q3ETFEQV.js";import{createServices as Z}from"@dfinity/utils";var z=({IDL:e})=>{let t=e.Nat64,r=e.Record({start:t,length:e.Nat64}),n=e.Nat64,c=e.Vec(e.Nat8),o=e.Record({e8s:e.Nat64}),a=e.Variant({Burn:e.Record({from:c,amount:o}),Mint:e.Record({to:c,amount:o}),Transfer:e.Record({to:c,fee:o,from:c,amount:o})}),i=e.Record({timestamp_nanos:e.Nat64}),l=e.Record({memo:n,operation:e.Opt(a),created_at_time:i}),d=e.Record({transaction:l,timestamp:i,parent_hash:e.Opt(e.Vec(e.Nat8))}),m=e.Record({blocks:e.Vec(d)}),T=e.Variant({BadFirstBlockIndex:e.Record({requested_index:t,first_valid_index:t}),Other:e.Record({error_message:e.Text,error_code:e.Nat64})}),p=e.Variant({Ok:m,Err:T}),x=e.Func([r],[p],[]),w=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(d),chain_length:e.Nat64,first_block_index:t,archived_blocks:e.Vec(e.Record({callback:x,start:t,length:e.Nat64}))}),F=e.Record({account:c}),v=e.Record({canister_id:e.Principal}),A=e.Record({archives:e.Vec(v)}),k=e.Vec(e.Nat8),N=e.Record({to:c,fee:o,memo:n,from_subaccount:e.Opt(k),created_at_time:e.Opt(i),amount:o}),B=e.Variant({TxTooOld:e.Record({allowed_window_nanos:e.Nat64}),BadFee:e.Record({expected_fee:o}),TxDuplicate:e.Record({duplicate_of:t}),TxCreatedInFuture:e.Null,InsufficientFunds:e.Record({balance:o})}),S=e.Variant({Ok:t,Err:B}),O=e.Record({}),q=e.Record({transfer_fee:o});return e.Service({_blocks:e.Func([r],[w],[]),account_balance:e.Func([F],[o],[]),archives:e.Func([],[A],[]),decimals:e.Func([],[e.Record({decimals:e.Nat32})],[]),name:e.Func([],[e.Record({name:e.Text})],[]),symbol:e.Func([],[e.Record({symbol:e.Text})],[]),transfer:e.Func([N],[S],[]),transfer_fee:e.Func([O],[q],[])})};var G=({IDL:e})=>{let t=e.Vec(e.Nat8),r=e.Record({account:t}),n=e.Record({e8s:e.Nat64}),c=e.Record({canister_id:e.Principal}),o=e.Record({archives:e.Vec(c)}),a=e.Nat64,i=e.Record({start:a,length:e.Nat64}),l=e.Nat64,d=e.Variant({Burn:e.Record({from:t,amount:n}),Mint:e.Record({to:t,amount:n}),Transfer:e.Record({to:t,fee:n,from:t,amount:n})}),m=e.Record({timestamp_nanos:e.Nat64}),T=e.Record({memo:l,operation:e.Opt(d),created_at_time:m}),p=e.Record({transaction:T,timestamp:m,parent_hash:e.Opt(e.Vec(e.Nat8))}),x=e.Record({blocks:e.Vec(p)}),w=e.Variant({BadFirstBlockIndex:e.Record({requested_index:a,first_valid_index:a}),Other:e.Record({error_message:e.Text,error_code:e.Nat64})}),F=e.Variant({Ok:x,Err:w}),v=e.Func([i],[F],["query"]),A=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(p),chain_length:e.Nat64,first_block_index:a,archived_blocks:e.Vec(e.Record({callback:v,start:a,length:e.Nat64}))}),k=e.Vec(e.Nat8),N=e.Record({to:t,fee:n,memo:l,from_subaccount:e.Opt(k),created_at_time:e.Opt(m),amount:n}),B=e.Variant({TxTooOld:e.Record({allowed_window_nanos:e.Nat64}),BadFee:e.Record({expected_fee:n}),TxDuplicate:e.Record({duplicate_of:a}),TxCreatedInFuture:e.Null,InsufficientFunds:e.Record({balance:n})}),S=e.Variant({Ok:a,Err:B}),O=e.Record({}),q=e.Record({transfer_fee:n});return e.Service({account_balance:e.Func([r],[n],["query"]),archives:e.Func([],[o],["query"]),decimals:e.Func([],[e.Record({decimals:e.Nat32})],["query"]),name:e.Func([],[e.Record({name:e.Text})],["query"]),query_blocks:e.Func([i],[A],["query"]),symbol:e.Func([],[e.Record({symbol:e.Text})],["query"]),transfer:e.Func([N],[S],[]),transfer_fee:e.Func([O],[q],["query"])})};var s=E(H());var R=E(H());import{arrayOfNumberToUint8Array as Y}from"@dfinity/utils";var J=e=>{let t=new Uint8Array(e).buffer,r=new R.Subaccount;return r.setSubAccount(new Uint8Array(t)),r},V=e=>{let t=new R.ICPTs;return t.setE8s(e.toString(10)),t},j=e=>({e8s:e}),$=({to:e,amount:t,memo:r,fee:n,fromSubAccount:c})=>({to:e.toUint8Array(),fee:j(n??f),amount:j(t),memo:r??BigInt(0),created_at_time:[],from_subaccount:c===void 0?[]:[Y(c)]});var u=class extends Error{},C=class extends u{},y=class extends u{constructor(r){super();this.balance=r}},h=class extends u{constructor(r){super();this.allowed_window_secs=r}},b=class extends u{},g=class extends u{constructor(r){super();this.duplicateOf=r}},P=class extends u{constructor(r){super();this.expectedFee=r}},K=e=>"TxDuplicate"in e?new g(e.TxDuplicate.duplicate_of):"InsufficientFunds"in e?new y(e.InsufficientFunds.balance.e8s):"TxCreatedInFuture"in e?new b:"TxTooOld"in e?new h(Number(e.TxTooOld.allowed_window_nanos)):"BadFee"in e?new P(e.BadFee.expected_fee.e8s):new u(`Unknown error type ${JSON.stringify(e)}`),X=e=>{let{message:t}=e;if(t.includes("Reject code: 5")){if(t.match(/Sending from (.*) is not allowed/))return new C;{let r=t.match(/transaction.*duplicate.* in block (\d+)/);if(r&&r.length>1)return new g(BigInt(r[1]))}{let r=t.match(/debit account.*, current balance: (\d*(\.\d*)?)/);if(r&&r.length>1){let n=U(r[1]);if(typeof n=="bigint")return new y(n)}}if(t.includes("is in future"))return new b;{let r=t.match(/older than (\d+)/);if(r&&r.length>1)return new h(Number.parseInt(r[1]))}}throw e};var _=class{constructor(t,r,n,c,o,a,i=!1){this.agent=t;this.canisterId=r;this.service=n;this.certifiedService=c;this.updateFetcher=o;this.queryFetcher=a;this.hardwareWallet=i}static create(t={}){let r=t.canisterId??M,{service:n,certifiedService:c,agent:o}=Z({options:{...t,canisterId:r},idlFactory:G,certifiedIdlFactory:z});return new _(o,r,n,c,t.updateCallOverride??W,t.queryCallOverride??Q,t.hardwareWallet)}accountBalance=async({accountIdentifier:t,certified:r=!0})=>this.hardwareWallet?this.accountBalanceHardwareWallet({accountIdentifier:t,certified:r}):(await(r?this.certifiedService:this.service).account_balance({account:t.toUint8Array()})).e8s;transactionFee=async()=>{let{transfer_fee:{e8s:t}}=await this.service.transfer_fee({});return t};transfer=async t=>{if(this.hardwareWallet)return this.transferHardwareWallet(t);t.fee===void 0&&(t.fee=this.hardwareWallet?f:await this.transactionFee());let r=$(t),n=await this.certifiedService.transfer(r);if("Err"in n)throw K(n.Err);return n.Ok};accountBalanceHardwareWallet=async({accountIdentifier:t,certified:r=!0})=>{let n=r?this.updateFetcher:this.queryFetcher,c=new s.AccountBalanceRequest;c.setAccount(t.toProto());let o=await n({agent:this.agent,canisterId:this.canisterId,methodName:"account_balance_pb",arg:c.serializeBinary()});return BigInt(s.ICPTs.deserializeBinary(new Uint8Array(o)).getE8s())};transferHardwareWallet=async({to:t,amount:r,memo:n,fee:c,fromSubAccount:o})=>{let a=new s.SendRequest;a.setTo(t.toProto());let i=new s.Payment;i.setReceiverGets(V(r)),a.setPayment(i),a.setMaxFee(V(c??f));let l=new s.Memo;l.setMemo((n??BigInt(0)).toString()),a.setMemo(l),o!==void 0&&a.setFromSubaccount(J(o));try{let d=await this.updateFetcher({agent:this.agent,canisterId:this.canisterId,methodName:"send_pb",arg:a.serializeBinary()});return BigInt(s.BlockHeight.deserializeBinary(d).getHeight())}catch(d){throw d instanceof Error?X(d):d}}};export{u as a,C as b,y as c,h as d,b as e,g as f,P as g,K as h,X as i,_ as j};
//# sourceMappingURL=chunk-NA2JZFZA.js.map
